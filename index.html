<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRUKS CHAT</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif}

body{
background:linear-gradient(135deg,#0f172a,#1e293b);
color:white;
height:100vh;
display:flex;
justify-content:center;
align-items:center;
}

/* Auth Card */
.container{
width:95%;
max-width:400px;
background:#1e293b;
padding:30px;
border-radius:20px;
box-shadow:0 20px 40px rgba(0,0,0,.4);
}

.logo{
text-align:center;
font-weight:800;
font-size:22px;
margin-bottom:20px;
}

input{
width:100%;
padding:12px;
margin:8px 0;
border:none;
border-radius:12px;
background:#334155;
color:white;
}

button{
width:100%;
padding:12px;
border:none;
border-radius:12px;
background:linear-gradient(45deg,#3b82f6,#6366f1);
color:white;
font-weight:700;
cursor:pointer;
margin-top:8px;
}

button:hover{opacity:.85}

.divider{
text-align:center;
margin:10px 0;
font-size:12px;
opacity:.6;
}

.error{
color:#ef4444;
text-align:center;
margin-top:8px;
font-size:13px;
}

/* Chat */
.chat{
display:none;
flex-direction:column;
height:100vh;
width:100%;
max-width:500px;
background:#0f172a;
}

.chat-header{
padding:15px;
background:#1e293b;
display:flex;
justify-content:space-between;
font-weight:700;
}

.messages{
flex:1;
overflow-y:auto;
padding:15px;
display:flex;
flex-direction:column;
gap:10px;
}

.message{
max-width:75%;
padding:10px 14px;
border-radius:18px;
font-size:14px;
}

.me{
background:#3b82f6;
align-self:flex-end;
border-bottom-right-radius:4px;
}

.other{
background:#1f2937;
align-self:flex-start;
border-bottom-left-radius:4px;
}

.chat-input{
display:flex;
padding:10px;
background:#1e293b;
gap:6px;
}

.chat-input input{
flex:1;
}

.chat-input button{
width:auto;
padding:10px 16px;
}
</style>
</head>
<body>

<div class="container" id="authBox">

<div class="logo">PRUKS CHAT</div>

<input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
<button id="registerBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>

<div class="divider">Ø£Ùˆ</div>

<button id="googleBtn">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google</button>
<button id="appleBtn">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Apple</button>

<p class="error" id="errorMsg"></p>

</div>

<div class="chat" id="chatBox">

<div class="chat-header">
<span>PRUKS CHAT</span>
<button id="logoutBtn">Ø®Ø±ÙˆØ¬</button>
</div>

<div class="messages" id="messages"></div>

<div class="chat-input">
<input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
<button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword,
onAuthStateChanged, signOut, GoogleAuthProvider, OAuthProvider, signInWithPopup }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import { getFirestore, collection, addDoc,
onSnapshot, serverTimestamp, query, orderBy }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ðŸ” Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ Ù…Ø®ÙÙŠ */
const SECRET_CODE_HASH = btoa("ali3mk");

const firebaseConfig={
apiKey:"AIzaSyBNUHCVjxnCISn-DdcT5HlJfwUkx3ZEiDk",
authDomain:"pro-83f6a.firebaseapp.com",
projectId:"pro-83f6a",
storageBucket:"pro-83f6a.firebasestorage.app",
messagingSenderId:"665223332117",
appId:"1:665223332117:web:8716516df53a164133a91c"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let unsubscribe=null;

/* Email */
loginBtn.onclick=()=>{
signInWithEmailAndPassword(auth,email.value,password.value)
.catch(e=>errorMsg.textContent=e.message);
};

registerBtn.onclick=()=>{
createUserWithEmailAndPassword(auth,email.value,password.value)
.catch(e=>errorMsg.textContent=e.message);
};

/* Google */
googleBtn.onclick=()=>{
const provider=new GoogleAuthProvider();
signInWithPopup(auth,provider);
};

/* Apple */
appleBtn.onclick=()=>{
const provider=new OAuthProvider('apple.com');
signInWithPopup(auth,provider);
};

onAuthStateChanged(auth,user=>{
if(user){

/* ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ */
if(SECRET_CODE_HASH !== btoa("ali3mk")){
signOut(auth);
return;
}

authBox.style.display="none";
chatBox.style.display="flex";
loadMessages();

}else{
authBox.style.display="block";
chatBox.style.display="none";
}
});

logoutBtn.onclick=()=>signOut(auth);

/* Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© */
sendBtn.onclick=async ()=>{
const text=messageInput.value.trim();
if(!text) return;

await addDoc(collection(db,"messages"),{
uid:auth.currentUser.uid,
text,
time:serverTimestamp()
});

messageInput.value="";
};

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
function loadMessages(){

if(unsubscribe) unsubscribe();

const q=query(collection(db,"messages"),orderBy("time"));
unsubscribe=onSnapshot(q,snap=>{
messages.innerHTML="";
snap.forEach(doc=>{
const d=doc.data();
const div=document.createElement("div");
div.className="message "+(d.uid===auth.currentUser.uid?"me":"other");
div.textContent=d.text;
messages.appendChild(div);
});
messages.scrollTop=messages.scrollHeight;
});
}

</script>

</body>
</html>